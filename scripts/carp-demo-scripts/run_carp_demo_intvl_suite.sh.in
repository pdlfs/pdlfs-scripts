#!/usr/bin/env bash

INSTALL_PREFIX=@CMAKE_INSTALL_PREFIX@
source $INSTALL_PREFIX/scripts/carp_demo_common.sh

# directory for carp output
JOB_DIR=$JOB_ROOT/carp-intvl-suite

setup_carp() {
  BASE_DIR=$1

  EXP_DIR=$BASE_DIR
  VPIC_DIR=$EXP_DIR/vpic
  PLFS_DIR=$EXP_DIR/plfs
  INFO_DIR=$EXP_DIR/exp-info

  LOG_FILE=$EXP_DIR/log.txt

  mkdir -p $VPIC_DIR
  mkdir -p $PLFS_DIR/particle
  mkdir -p $INFO_DIR
}

run_intvl_suite() {
  for RENEG_INTVL in "${RENEG_INTVLS_SUITE[@]}"; do
    cat <<EOF
$(big_line)
Running range-runner + CARP with interval: $RENEG_INTVL

EOF
  confirm
  BASE_DIR=$JOB_DIR/intvl.$RENEG_INTVL

  setup_carp $BASE_DIR
  run_carp

  cat <<EOF
$(small_line)
Run completed. Note "num renegotiations."
EOF
  done
}

run_intvl_suite
